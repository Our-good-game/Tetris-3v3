<!DOCTYPE html>
<html>

<head>
  <script src='/JS/timer.js'></script>
  <script src='/JS/render.js'></script>
  <script src='/JS/player-interface.js'></script>
  <script src='/JS/classic-tetris.js'></script>
  <script src='/JS/classic-tetris-3v3.js'></script>
  <script src='/socket.io/socket.io.js'></script>
  <script src='/JS/size.js'></script>
  <script src='/JS/heart.js'></script>
  <script src='/JS/EnergyBar.js'></script>
  <style>
    @import"/CSS/style.css";
    @import"/CSS/energyBar.css";
    @font-face {
      font-family: huakang_girl_w5;
      src: url(huakang_girl_w5.ttf);
    }
  </style>
  <img src="/picture/heart.png" id ="heart" style="display:none"></img>
</head>

<body>
  <div style='user-select: none;'>
    <!-- 載入huakang_girl_w5字體 -->
    <div style='font-family: huakang_girl_w5; font-size: 0px;'>Combo</div>
    <canvas id='js-background'></canvas>
    <div>
      <div id='player-name'
        style="position:absolute; top:100px; left:100px; color:rgb(54, 170, 238); font:36px georgia">
      </div>
      <div id='player2-name'
        style="position:absolute; top:100px; left:1000px; color:rgb(54, 170, 238); font:36px georgia">
      </div>
      
      <div class='container'>
        <canvas id='HUD' style="position:absolute;"></canvas>
        <canvas id='player' class='tetris-canvas' style="height: 85%;"></canvas>

        <div class="meter" style="height: 40%; position:absolute; top: 0px; left: 0px; ">
          <span id="energy" style="height: 60%"></span>
        </div>

        <canvas id='teammate1' class='tetris-canvas' style="position:absolute; height: 40%;"></canvas>
        <canvas id='teammate2' class='tetris-canvas' style="position:absolute; height: 40%;"></canvas>
      
        <canvas id='opponent1' class='tetris-canvas' style="position:absolute; height: 35%;"></canvas>
        <canvas id='opponent2' class='tetris-canvas' style="position:absolute; height: 35%;"></canvas>
        <canvas id='opponent3' class='tetris-canvas' style="position:absolute; height: 35%;"></canvas>
     
      <!--
        <div class='text'>
          <canvas id='HUD' style='width: 100%; height: 100%; '></canvas>
        </div>
      -->
        <!-- <canvas id='opponent' class='tetris-canvas'></canvas>-->
        
      </div>
    </div>
  <!-- 
    <div style='left:45%; top:50%; z-index: 3; position:fixed; text-align: center;'>
      <button id='start-stop-btn'>Play</button><br>
      <button id='find'>find</button><br>
      <button id='quit'>Quit</button><br>  
    </div>
  -->
  </div>
  
</body>
<script src="/JS/background.js"></script>
<script>
/*
  var canvas_opponent = document.getElementById('opponent');
  canvas_opponent.height = window.innerHeight;
  canvas_opponent.width = window.innerHeight;
*/
  var HUD = document.getElementById('HUD');
  HUD.height = window.innerHeight * 0.15;
  HUD.width = window.innerWidth;

  // document.getElementsByClassName('container')
  var player = document.getElementById('player');
  player.height = window.innerHeight;
  player.width = window.innerWidth * 0.45;
  player.style.top = HUD.height + "px";
  player.style.left = window.innerWidth / 3.5 + "px";

  var teammate1 = document.getElementById('teammate1');
  teammate1.height = window.innerHeight;
  teammate1.width = window.innerWidth * 0.45;
  teammate1.style.top = HUD.height + "px";
  teammate1.style.left = window.innerWidth / 15 + "px";

  var teammate2 = document.getElementById('teammate2');
  teammate2.height = window.innerHeight;
  teammate2.width = window.innerWidth * 0.45;
  teammate2.style.top = (HUD.height +  teammate2.height * 0.4) + "px";
  teammate2.style.left = window.innerWidth / 15 + "px";
/* ----------------------------------------------------------------------------------------------*/
  var opponent1 = document.getElementById('opponent1');
  opponent1.height = window.innerHeight
  opponent1.width = window.innerWidth * 0.45;
  opponent1.style.top = HUD.height + "px";
  opponent1.style.left = window.innerWidth * 0.75 + "px";

  var opponent2 = document.getElementById('opponent2');
  opponent2.height = window.innerHeight;
  opponent2.width = window.innerWidth * 0.45;
  opponent2.style.top = (HUD.height +  opponent2.height * 0.4) + "px";
  opponent2.style.left = window.innerWidth * 0.67 + "px";

  var opponent3 = document.getElementById('opponent3');
  opponent3.height = window.innerHeight;
  opponent3.width = window.innerWidth * 0.45;
  opponent3.style.top = (HUD.height +  opponent3.height * 0.4) + "px";
  opponent3.style.left = window.innerWidth * 0.83 + "px";
  
  var draw = new Render();
  // 主遊戲邏輯
  var gamecore = new ClassicTetris3v3();  
  // 隊友遊戲資料       
  var teammate1Core = new PlayerInterface(); 
  var teammate2Core = new PlayerInterface();
  // 敵人遊戲資料
  var opponent1Core = new PlayerInterface(); 
  var opponent2Core = new PlayerInterface();
  var opponent3Core = new PlayerInterface();

  var myCanvas = new teamModSize (player);
  var teammate1Canvas = new teamModSize (teammate1);
  var teammate2Canvas = new teamModSize (teammate2);
  var opponent1Canvas = new teamModSize (opponent1);
  var opponent2Canvas = new teamModSize (opponent2);
  var opponent3Canvas = new teamModSize (opponent3);

  var teamHeart = new Array(5)
  var opponentHeart = new Array(5)
  for (let i = 1; i<= 5; ++i){
    teamHeart[i] = new heart(i, "left", HUD)
    opponentHeart[i] = new heart(i, "right", HUD)
  }
  window.onload = function () {
    draw._render(gamecore, myCanvas);
    draw._renderNoHUD(teammate1Core, teammate1Canvas);
    draw._renderNoHUD(teammate2Core, teammate2Canvas);
    draw._renderNoHUD(opponent1Core, opponent1Canvas);
    draw._renderNoHUD(opponent2Core, opponent2Canvas);
    draw._renderNoHUD(opponent3Core, opponent3Canvas);
    for (let i = 1; i<= 5; ++i){
      teamHeart[i].paint()
      opponentHeart[i].paint()
    }
  }
  var id = undefined
  var socket = io()

  window.addEventListener('load', event => {
    fetch('id')
      .then(function (response) { return response.text(); })
      .then(function (data) {
        id = data;
        myCanvas.playerName = id;
        draw._drawPlayerName (gamecore,myCanvas);
      })
  });
  function SendData(data) {
    let datatmp = {
      gameState: data.gameState,
      board: data.board,
      piecePosition: data.piecePosition,
      pieceRotation: data.pieceRotation,
      piece: data.piece,
      haveHold: data.haveHold,
      holdPiece: data.holdPiece,
      lines: data.lines,
      next:[data.next[0],data.next[1],data.next[2]],
      burnOn: data.burnOn,
      result: data.result
    }
  };

  socket.on('teamGamming', function (data) {
    // load data
    // draw teammate
    // draw opponent
  })
  socket.on('fight', function (opponent) {
    // trigger gameloop 
  })
  // 能量條
  var energyBar = new EnergyBar (document.getElementsByClassName('meter')[0], document.getElementById('energy'));
</script>

</html>